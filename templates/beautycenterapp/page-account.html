{% extends "base.html" %} {% load static %} {% block maincontents %} {% load custom_filters %}
<!--End header-->
<style>
    .modal-content {
        border-radius: 10px;
    }
    
    .modal-header {
        background-color: #81c408 !important;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
    }
    
    .modal-title {
        margin: 0;
    }
    
    .modal-body {
        padding: 20px;
    }
    
    .modal-footer {
        padding: 20px;
        justify-content: space-between;
        border-top: none;
    }
    
    .header {
        text-align: center;
        margin-bottom: 10px;
    }
    
    .details {
        text-align: center;
        margin-top: -40px;
    }
    
    .details p {
        margin: 5px 0;
    }
    
    .invoice-half {
        width: 48%;
    }
</style>
<main class="main pages">
    <div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="/" rel="nofollow"><i class="fi-rs-home mr-5"></i>Home</a>
                <span></span> Pages <span></span> My Account
            </div>
        </div>
    </div>
    <div class="page-content pt-150 pb-150">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 m-auto">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="dashboard-menu">
                                <ul class="nav flex-column" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" href="#dashboard" role="tab" aria-controls="dashboard" aria-selected="false"><i class="fi-rs-settings-sliders mr-10"></i>Dashboard</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="dashboard-tab" data-bs-toggle="tab" href="#creditUser" role="tab" aria-controls="dashboard" aria-selected="false"><i class="fi-rs-settings-sliders mr-10"></i>Credit User</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders" role="tab" aria-controls="orders" aria-selected="false"><i class="fi-rs-shopping-bag mr-10"></i>Orders</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#track-orders" role="tab" aria-controls="track-orders" aria-selected="false"><i class="fi-rs-shopping-cart-check mr-10"></i>Track Your Order</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address" role="tab" aria-controls="address" aria-selected="true"><i class="fi-rs-marker mr-10"></i>My Address</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="account-detail-tab" data-bs-toggle="tab" href="#account-detail" role="tab" aria-controls="account-detail" aria-selected="true"><i class="fi-rs-user mr-10"></i>Account details</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="account-detail-tab" data-bs-toggle="tab" href="#change-pass" role="tab" aria-controls="account-detail" aria-selected="true"><i class="fi-rs-user mr-10"></i>Change Password</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'signout' %}"><i class="fi-rs-sign-out mr-10"></i>Logout</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="tab-content account dashboard-content pl-50">
                                <div class="tab-pane fade active show" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="mb-0">Hello {{request.user.get_full_name}}!</h3>
                                        </div>
                                        <div class="card-body">
                                            <p>
                                                From your account dashboard. you can easily check &amp; view your <a href="#">recent orders</a>,<br /> manage your <a href="#">shipping and billing addresses</a> and <a href="#">edit your password and account details.</a>
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div class="tab-pane fade" id="creditUser" role="tabpanel" aria-labelledby="creditUser-tab">
                                    <div class="card">
                                        <div class="card-header">
                                            <button type="button" class="btn btn-fill-out submit font-weight-bold" data-bs-toggle="modal" data-bs-target="#exampleModal-2">Create Credit User</button>
                                            <!-- <h3 class="mb-0">Hello {{request.user.get_full_name}}!</h3> -->
                                        </div>
                                        <div class="card-body">
                                            <p class="text-center">List of Credits User</p>
                                            {% if staffs %}
                                            <table border="1" style="text-align:center;">
                                                <thead>
                                                    <th>S. No.</th>
                                                    <th>Name</th>
                                                    <th>Email</th>
                                                    <th>Username</th>
                                                    <th>Action</th>
                                                </thead>
                                                <tbody>
                                                    <hr> {% for s in staffs %}
                                                    <tr>
                                                        <td>{{s.id}}</td>
                                                        <td>{{s.first_name}} {{s.last_name}}</td>
                                                        <td>{{s.email}}</td>
                                                        <td>{{s.username}}</td>
                                                        <td>
                                                            <div class="d-flex">
                                                                <button class="btn btn-danger mx-2"><i class="fi fi-rs-delete"></i></button>
                                                                <button class="btn btn-danger"><i class="fi fi-rs-edit"></i></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>{% else %}
                                            <p class="text-center text-red">No any data of staff! Create with above button.</p> {% endif %}
                                        </div>
                                    </div>

                                </div>

                                <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="mb-0">Your Orders</h3>
                                        </div>
                                        {% if context.confirmed_order_items %}
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>Order</th>
                                                            <th>Product Title</th>
                                                            <th>Date</th>
                                                            <th>Delivery Status</th>
                                                            <th>Payment Status</th>
                                                            <th>Total</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for co in context.confirmed_order_items %}
                                                        <tr>
                                                            <td>{{co.provider_order_id}}</td>
                                                            <td>{{co.product.title}}</td>
                                                            <td>{{co.created_at}}</td>
                                                            <td>{{co.delivery_status}}</td>
                                                            <td>{{co.order.payment_status}}</td>
                                                            <td>₹{{co.product.price|multiply:co.quantity}} for {{co.quantity}} item</td>
                                                            <td><a href="{% url 'orderTrack' %}" class="btn-small d-block">View</a></td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        {% else %}
                                        <div class="card-body">
                                            <p>There is not order items exit on your account!</p>
                                            <a href="{% url 'market' %}" class="btn btn-primary"><i class="fi fi-rs-forward"></i>Shop Now</a>
                                        </div> {% endif %}
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="track-orders" role="tabpanel" aria-labelledby="track-orders-tab">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="mb-0">Orders tracking</h3>
                                        </div>
                                        {% if context.confirmed_order_items %}
                                        <div class="card-body contact-from-area">
                                            <p>To track your order please enter your OrderID in the box below and press "Track" button. This was given to you on your receipt and in the confirmation email you should have received.</p>
                                            <div class="row">
                                                <div class="col-lg-8">
                                                    <form class="contact-form-style mt-30 mb-50" id="order-search-form" method="post">
                                                        {% csrf_token %}
                                                        <div class="input-style mb-20">
                                                            <label>Order ID</label>
                                                            <input name="order-id" id="order-id" placeholder="Found in your order by Order ID" type="text" required />
                                                        </div>
                                                        <button type="button" class="btn btn-primary p-3" id="search-order-btn">Track</button>
                                                    </form>
                                                    <div id="order-result"></div>
                                                </div>

                                            </div>
                                        </div>{% else %}
                                        <div class="card-body">
                                            <p>There is not order items exit on your account!</p>
                                            <a href="{% url 'market' %}" class="btn btn-primary"><i class="fi fi-rs-forward"></i>Shop Now</a>
                                        </div> {% endif %}
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="address" role="tabpanel" aria-labelledby="address-tab">
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="card mb-3 mb-lg-0">
                                                <div class="card-header">
                                                    <h3 class="mb-0">Billing Address</h3>
                                                </div>
                                                <div class="card-body">
                                                    <address>
                                                                3522 Interstate<br />
                                                                75 Business Spur,<br />
                                                                Sault Ste. <br />Marie, MI 49783
                                                            </address>
                                                    <p>New York</p>
                                                    <a href="#" class="btn-small">Edit</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="mb-0">Shipping Address</h5>
                                                </div>
                                                <div class="card-body">
                                                    <address>
                                                                4299 Express Lane<br />
                                                                Sarasota, <br />FL 34249 USA <br />Phone: 1.941.227.4444
                                                            </address>
                                                    <p>Sarasota</p>
                                                    <a href="#" class="btn-small">Edit</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="tab-pane fade" id="account-detail" role="tabpanel" aria-labelledby="account-detail-tab">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5>Account Details</h5>
                                        </div>
                                        <div class="card-body">
                                            <!-- <p>Already have an account? <a href="page-login.html">Log in instead!</a></p> -->

                                            <form method="post" name="enq">
                                                <div class="row">
                                                    <div class="form-group col-md-6">
                                                        <label>First Name <span class="required">*</span></label>
                                                        <input required="" class="form-control" name="name" type="text" value="{{context.user_detail.first_name}}" disabled/>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label>Last Name <span class="required">*</span></label>
                                                        <input required="" class="form-control" name="phone" value="{{context.user_detail.last_name}}" disabled/>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label>User Name <span class="required">*</span></label>
                                                        <input required="" class="form-control" name="username" type="text" value="{{context.user_detail.username}}" disabled/>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label>Email Address <span class="required">*</span></label>
                                                        <input required="" class="form-control" name="email" type="email" value="{{context.user_detail.email}}" disabled/>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label>Phone No.<span class="required">*</span></label>
                                                        <input required class="form-control" name="phone_no" type="number" value="{{context.user_detail.phone_number}}" disabled/>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label>Alternate Phone No.<span class="required"></span></label>
                                                        <input class="form-control" name="phone_no" type="number" value="{{context.alter_phone_no}}" disabled/>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label>GST No.<span class="required"></span></label>
                                                        <input class="form-control" name="gst_no" type="text" value="{{context.gst_no}}" disabled/>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <button type="button" class="btn btn-fill-out submit font-weight-bold" data-bs-toggle="modal" data-bs-target="#exampleModal">Update</button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                                <div class="tab-pane fade" id="change-pass" role="tabpanel" aria-labelledby="account-detail-tab">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5>Change old password</h5>
                                        </div>
                                        <div class="card-body">
                                            <form method="post" name="enq" action="{% url 'passchange' %}">
                                                {% csrf_token %}
                                                <div class="row">
                                                    <div class="form-group col-md-12">
                                                        <label>Current Password <span class="required">*</span></label>
                                                        <input required="" class="form-control" name="current_password" type="password" />
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label>New Password <span class="required">*</span></label>
                                                        <input required="" class="form-control" name="new_password" type="password" />
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label>Confirm Password <span class="required">*</span></label>
                                                        <input required="" class="form-control" name="confirm_new_password" type="password" />
                                                    </div>
                                                    <div class="col-md-12">
                                                        <button type="submit" class="btn btn-fill-out submit font-weight-bold">Update</button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Updates Details</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form method="post" name="enq" action="{% url 'useredit' %}">
                        {% csrf_token %}
                        <div class="row">
                            <div class="form-group col-md-6">
                                <label>First Name <span class="required">*</span></label>
                                <input required="" class="form-control" name="fname" type="text" value="{{context.user_detail.first_name}}" />
                            </div>
                            <div class="form-group col-md-6">
                                <label>Last Name <span class="required">*</span></label>
                                <input required="" class="form-control" name="lname" value="{{context.user_detail.last_name}}" />
                            </div>
                            <div class="form-group col-md-12">
                                <label>User Name <span class="required">*</span></label>
                                <input required="" class="form-control" name="username" type="text" value="{{context.user_detail.username}}" />
                            </div>
                            <div class="form-group col-md-12">
                                <label>Email Address <span class="required">*</span></label>
                                <input required="" class="form-control" name="email" type="email" value="{{context.user_detail.email}}" />
                            </div>
                            <div class="form-group col-md-12">
                                <label>Phone No.<span class="required">*</span></label>
                                <input required class="form-control" name="phone_no" type="number" value="{{context.user_detail.phone_number}}" />
                            </div>
                            <div class="form-group col-md-12">
                                <label>Alternate Phone No.<span class="required"></span></label>
                                <input class="form-control" name="alt_phone_no" type="number" value="{{context.alter_phone_no}}" />
                            </div>
                            <div class="form-group col-md-12">
                                <label>GST No.<span class="required"></span></label>
                                <input class="form-control" name="gst_no" type="text" value="{{context.gst_no}}" />
                            </div>
                        </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal-2 -->
    <div class="modal fade" id="exampleModal-2" tabindex="-1" aria-labelledby="exampleModalLabel-2" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Create Your Credits Users</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form method="post" name="enq" action="{% url 'useredit' %}">
                        {% csrf_token %}
                        <div class="row">
                            <div class="form-group col-md-6">
                                <label>First Name <span class="required">*</span></label>
                                <input required="" class="form-control" name="fname" type="text" />
                            </div>
                            <div class="form-group col-md-6">
                                <label>Last Name <span class="required">*</span></label>
                                <input required="" class="form-control" name="lname" />
                            </div>
                            <div class="form-group col-md-12">
                                <label>User Name <span class="required">*</span></label>
                                <input required="" class="form-control" name="username" type="text" />
                            </div>
                            <div class="form-group col-md-12">
                                <label>Email Address <span class="required">*</span></label>
                                <input required="" class="form-control" name="email" type="email" />
                            </div>
                            <div class="form-group col-md-12">
                                <label>Password<span class="required"></span></label>
                                <input class="form-control" name="password" type="password" placeholder="Password*" />
                            </div>
                            <div class="form-group col-md-12">
                                <label>Confirm Password<span class="required"></span></label>
                                <input class="form-control" name="cpassword" type="text" placeholder="Confirm Password*" />
                            </div>
                        </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal-3" tabindex="-1" aria-labelledby="exampleModalLabel-3" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-bg-primary" id="exampleModalLabel">Invoice Information</h5>
                </div>
                <div class="modal-body">
                    <img src="{% static 'img/invoice-demo.png' %}" alt="">
                    <div>
                        <div class="header">
                            <div class="details">
                                <p>GSTIN: 29ABMPD9358D2ZC</p>
                                <h2>Sales Quotation</h2>
                                <p><strong>BEAUTY CENTRE</strong></p>
                                <p>No.9, OTC ROAD, Opp ICICI Bank, Near Sharda Theatre<br> Bangalore-560002
                                    <br> Tel: 080-41238915<br> Email: contactbeautycentre@gmail.com</p>
                            </div>
                        </div>
                        <table id="invoiceTable">
                            <thead>
                                <tr>
                                    <th colspan="2">Invoice Number: <span id="invoiceNumber"></span></th>
                                    <th colspan="2" style="text-align: right;" id="currentDate"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="2" style="width: 0%; vertical-align: top;">
                                        <div class="invoice-half">
                                            <b>Bill To:</b><br>
                                            <span id="billingName"></span>,<br>
                                            <span id="billingAddress"></span>,<br>
                                            <span id="billingCity"></span>,<br>
                                            <span id="billingCountry"></span>,<br>
                                            <span id="billingPincode"></span>
                                        </div>
                                    </td>
                                    <td colspan="2" style="width: 60%; vertical-align: top;">
                                        <div class="invoice-half">
                                            <b>Payment Status:</b> <span id="paymentStatus"></span><br>
                                            <b>Order ID:</b> <span id="orderId"></span><br>
                                            <b>Delivery Status:</b> <span id="deliveryStatus"></span><br>
                                            <b>Tracking ID:</b> <span id="trackingId"></span><br>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Description</th>
                                    <th>Quantity</th>
                                    <th>Unit Price (₹)</th>
                                    <th>Total (₹)</th>
                                </tr>
                                <tbody id="orderItems">
                                    <!-- Items will be dynamically inserted here -->
                                </tbody>
                                <tr>
                                    <th colspan="3" style="text-align: right;">Subtotal:</th>
                                    <td id="subtotal"></td>
                                </tr>
                                <tr>
                                    <th colspan="3" style="text-align: right;">Tax (18%):</th>
                                    <td id="gstCharge"></td>
                                </tr>
                                <tr>
                                    <th colspan="3" style="text-align: right;">Shipping:</th>
                                    <td id="shipping"></td>
                                </tr>
                                <tr>
                                    <th colspan="3" style="text-align: right;">Total Due:</th>
                                    <td id="totalDue"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-outline-primary" id="downloadBtn">Download</button>
                </div>
            </div>
        </div>
    </div>

</main>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('#search-order-btn').on('click', function(e) {
            e.preventDefault(); // Prevent form from submitting normally

            var orderId = $('#order-id').val(); // Get the order ID from the input

            if (orderId === "") {
                alert("Please enter an Order ID.");
                return;
            }

            $.ajax({
                url: "{% url 'search_order_by_id' %}", // Make sure this URL is correct
                type: 'POST',
                data: {
                    'order_id': orderId,
                    'csrfmiddlewaretoken': '{{ csrf_token }}' // Include CSRF token for security
                },
                success: function(response) {
                    if (response.success) {
                        var order = response.order;
                        var resultHtml = `
                            <div class="card mt-4">
                                <div class="card-body">
                                    <h5 class="card-title">Order ID: ${order.provider_order_id}</h5>
                                    <p><strong>Product:</strong> ${order.product_title}</p>
                                    <p><strong>Date:</strong> ${order.date}</p>
                                    <p><strong>Delivery Status:</strong> ${order.delivery_status}</p>
                                    <p><strong>Payment Status:</strong> ${order.payment_status}</p>
                                    <p><strong>Total:</strong> ₹${order.total} for ${order.quantity} item(s)</p>
                                    <a class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#exampleModal-3" data-orderid="{{ order.provider_order_id }}">View Invoice</a>
                                </div>
                            </div>
                        `;
                        $('#order-result').html(resultHtml);
                    } else {
                        $('#order-result').html(`<div class="alert alert-danger">${response.message}</div>`);
                    }
                },
                error: function(xhr, status, error) {
                    alert("An error occurred: " + error);
                }
            });
        });
    });
</script>
<script>
    // Display current date in the modal
    document.getElementById('currentDate').innerHTML = `Date: ${new Date().toDateString()}`;

    // Download Invoice as PDF
    document.getElementById('downloadBtn').addEventListener('click', function() {
        const invoiceTable = document.getElementById('invoiceTable');

        // Initialize jsPDF
        const doc = new jsPDF();

        // Add HTML content to PDF
        doc.html(invoiceTable, {
            callback: function(doc) {
                // Save the PDF with the file name
                doc.save('invoice.pdf');
            },
            x: 10,
            y: 10
        });
    });

    // Populate the modal with invoice details when opened
    document.addEventListener('DOMContentLoaded', function() {
        $('#exampleModal-3').on('show.bs.modal', function(event) {
            var button = $(event.relatedTarget); // Button that triggered the modal
            var providerOrderId = button.data('orderid'); // Extract order ID from data attribute
            console.log(`order id is ${button}`)
                // Make AJAX request to fetch invoice details
            $.ajax({
                url: `/get_invoice_details/${providerOrderId}/`, // Use the appropriate URL pattern
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    // Check if the response data is valid
                    if (data && data.invoice_number) {
                        // Update modal content with the fetched invoice data
                        $('#invoiceNumber').text(data.invoice_number || 'N/A');
                        $('#billingName').text(data.billing_address.name || 'N/A');
                        $('#billingAddress').text(data.billing_address.address || 'N/A');
                        $('#billingCity').text(data.billing_address.city || 'N/A');
                        $('#billingCountry').text(data.billing_address.country || 'N/A');
                        $('#billingPincode').text(data.billing_address.pincode || 'N/A');
                        $('#paymentStatus').text(data.payment_status || 'N/A');
                        $('#orderId').text(data.order_id || 'N/A');
                        $('#deliveryStatus').text(data.delivery_status || 'N/A');
                        $('#trackingId').text(data.tracking_id || 'N/A');

                        // Dynamically insert order items
                        var orderItems = data.items.map(function(item) {
                            return `
                            <tr>
                                <td>${item.title}</td>
                                <td>${item.quantity}</td>
                                <td>${item.unit_price.toFixed(2)}</td> <!-- Ensure correct formatting -->
                                <td>${item.total.toFixed(2)}</td>
                            </tr>
                        `;
                        }).join('');
                        $('#orderItems').html(orderItems || '<tr><td colspan="4">No items found</td></tr>');

                        // Update subtotal, tax, shipping, and total due
                        $('#subtotal').text(data.subtotal.toFixed(2) || '0.00');
                        $('#gstCharge').text(data.gst_charge.toFixed(2) || '0.00');
                        $('#shipping').text(data.shipping.toFixed(2) || '0.00');
                        $('#totalDue').text(data.total_due.toFixed(2) || '0.00');
                    } else {
                        alert("Invalid data received.");
                    }
                },
                error: function(xhr, status, error) {
                    alert("Failed to load invoice details. Please try again.");
                }
            });
        });
    });
</script>
{% endblock %}